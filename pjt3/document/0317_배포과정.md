# ë°°í¬

# â˜ï¸ AWS EC2

## ğŸ³ Docker

## Jenkins

### 1. Jenkins ì„¤ì¹˜

- ë²„ì „ : Jenkins 2.387.1
- jenkins ì´ë¯¸ì§€ ë‹¤ìš´
    
    `$ docker pull jenkins/jenkins:lts`â€™
    
- jenkins ì»¨í…Œì´ë„ˆ ë“±ë¡ í›„ ì‹¤í–‰
    
    `$ docker run -d -p 9090:8080 -v /jenkins:/var/jenkins_home --name jenkins -u root jenkins/jenkins:lts`
    

> íŠ¸ëŸ¬ë¸” : ìœ„ ë°©ì‹ëŒ€ë¡œ Jenkins ì»¨í…Œì´ë„ˆë¥¼ ë“±ë¡í•˜ë©´ Jenkinsë‚´ì—ì„œ í”ŒëŸ¬ê·¸ì¸ì´ ì •ìƒì ìœ¼ë¡œ ì„¤ì¹˜ê°€ ë˜ì§€ ì•ŠìŒ, ìˆ˜ë™ìœ¼ë¡œ ì„¤ì¹˜í•´ë„ gitlabê³¼ ì—°ê²°í•˜ëŠ”ë° ë‹¤ì–‘í•œ ì˜¤ë¥˜ê°€ ë°œìƒí•¨.
> 
> 
> í•´ê²° :  docker-compose ë¥¼ ì´ìš©í•´ì„œ jenkinsë¥¼ ì„¤ì¹˜í•˜ë©´ ë¬¸ì œì—†ì´ ì§„í–‰ë¨.
> 
> - **docker-compose ì´ìš© ì  í‚¨ìŠ¤ ì»¨í…Œì´ë„ˆ ìƒì„±**
>     
>     ```bash
>     $ vim docker-compose.yml
>     
>     # docker-compose.yml
>     version: '3'
>     
>     services:
>         jenkins:
>             image: jenkins/jenkins:lts
>             container_name: jenkins
>             volumes:
>     	    - /usr/bin/docker:/usr/bin/docker
>                 - /var/run/docker.sock:/var/run/docker.sock
>                 - /jenkins:/var/jenkins_home
>             ports:
>                 - "9090:8080"
>             privileged: true
>             user: root
>     
>     # ì»¨í…Œì´ë„ˆ ìƒì„±
>     $ sudo docker-compose up -d
>     ```
>     

### 2. Jenkins ì ‘ì†

- url: "í¼ë¸”ë¦­ IPv4 ì£¼ì†Œ:9090" ìœ¼ë¡œ ì ‘ì†
- íŒ¨ìŠ¤ì›Œë“œ ì°¾ê¸°
    
    `$ docker exec jenkins cat /var/jenkins_home/secrets/initialAdminPassword`
    
- ì ‘ì† í›„ gitlab, docker, ssh ê´€ë ¨ í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜

### 3. **ì  í‚¨ìŠ¤ í”„ë¡œì íŠ¸ ìƒì„±**

- Freestyle Project ìƒì„±
- ì†ŒìŠ¤ì½”ë“œ ê´€ë¦¬ -  Git
    - Repository URL ì‘ì„±
    - credentials ìƒì„±
        
        ```bash
        Username : ì‹¸í”¼ê¹ƒ ì•„ì´ë””
        Password : ì‹¸í”¼ê¹ƒ ë¹„ë°€ë²ˆí˜¸
        ID : ì•„ë¬´ê±°ë‚˜ ë§ˆìŒëŒ€ë¡œ
        ```
        
- ë¹Œë“œ ìœ ë°œ ì„¤ì •
- secret token  ìƒì„±

### 4. ê¹ƒë© ì›¹í›… ì—°ê²°

- settings - webhook
- jenkins project URL, secret token ì…ë ¥
- Trigger ì„¤ì •

### 5. Dockerfile ì‘ì„±

### 6. ìë™ ë°°í¬ ìŠ¤í¬ë¦½íŠ¸

- í•´ë‹¹ ë‹¨ê³„ë¥¼ ì§„í–‰í•˜ê¸° ì „ì— ê° í´ë”ì— Dockerfileì´ ì‘ì„±ë˜ì–´ ìˆì–´ì•¼ í•œë‹¤.
- jenkins í”„ë¡œì íŠ¸ ì„¤ì • - Build Steps - Execute shell ì„ íƒ => ì•„ë˜ ìŠ¤í¬ë¦½íŠ¸ ë³µì‚¬, ë¶™ì—¬ë„£ê¸°
    
    ```bash
    # frontend
    docker build -t frontimg ./frontend
    if (docker ps | grep "frontimg"); then docker stop frontimg; fi
    docker run -it -d --rm -p 3000:3000 --name frontimg frontimg
    echo "Run react"
    ```
    

### 7. **Nginx ê²½ë¡œ ì„¤ì •**

- **Nginxë¥¼ í†µí•´ Reactì™€ Spring Boot ê²½ë¡œ ì„¤ì •**

### Reference

[CICD_manual/ë§¤ë‰´ì–¼ v2 at main Â· hjs101/CICD_manual](https://github.com/hjs101/CICD_manual/tree/main/%EB%A7%A4%EB%89%B4%EC%96%BC%20v2)

## ğŸ¦– Nginx

- Ubuntuì—ì„œ Nginxì˜ ê¸°ë³¸ì ì¸ ì„¤ì¹˜ì™€ ì„¤ì •

### 1. **Nginx ì„¤ì¹˜**

```bash
$ sudo apt-get install nginx
```

### 2. ì„¤ì¹˜ í›„ Nginx ì‹¤í–‰

```bash
$ service nginx start
# or
$ sudo service nginx start
# or
$ sudo systemctl start nginx
```

### 3. **Nginx ì„¤ì •**

- ì»¤ìŠ¤í…€ ì„¤ì • íŒŒì¼ â†’ sites-available ë””ë ‰í† ë¦¬ í•˜ìœ„ì— test.conf íŒŒì¼ì„ ìƒì„±,  ìˆ˜ì •

```bash
$ vi /etc/nginx/sites-available/test.conf

# test.conf
server {
        listen 80;

        server_name j8c206.p.ssafy.io;

        location / {
            proxy_pass http://localhost:3000;
        }
}
```

- ìƒì„±í•œ test.confë¥¼ sites-enabled ë””ë ‰í† ë¦¬ì— ì‹¬ë³¼ë¦­ ë§í¬ ì„¤ì •

```bash
$ ln -s /etc/nginx/sites-available/test.conf /etc/nginx/sites-enabled/test.conf
```

- ë³€ê²½ ì‚¬í•­ì„ ì ìš©

```bash
$ service nginx restart
# or
$ sudo service nginx restart
# or
$ sudo systemctl restart nginx
```

### Reference

[[Ubuntu] Nginx ì„¤ì •](https://computer-science-student.tistory.com/737)